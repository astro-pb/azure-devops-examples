stages:
- stage: deploy
  jobs:
  - job: deploy_image
    pool: Default  # <-- Change this from 'Azure Pipelines'
    steps:
    - script: |
        curl -sSL install.astronomer.io | sudo bash -s
        echo 'Astro installed.'
        
        # Login to Astro
        # astro context list
        
        # # Create Astro project if not exists
        mkdir -p astro-test
        cd astro test
        astro dev init
 
        # # Deploy to Astro
        astro deploy $(ASTRO_DEPLOYMENT_ID) -f
      env:
        ASTRO_API_TOKEN: $(ASTRO_API_TOKEN)
        ASTRO_DEPLOYMENT_ID: $(ASTRO_DEPLOYMENT_ID)
      